- 네이버 업로드 파이프라인 개편:
  - `naver-poster/src/utils/parser.ts`에서 본문을 `text/image` 블록 배열로 파싱하도록 확장.
  - `(사진1)`, `[사진2]`, `(사진)` 마커를 이미지 블록으로 변환하고 텍스트 잔존 검출 로직 추가.
- 에디터 삽입 방식 개편:
  - `naver-poster/src/naver/editor.ts`에 `insertBlocksSequentially` 추가.
  - 텍스트/이미지를 순차 삽입해 "본문 입력 후 이미지 일괄 업로드" 구조 제거.
- 장소첨부 자동화 강화:
  - `naver-poster/src/naver/place.ts`를 재작성.
  - `fetch_place_candidates`, `pick_best_place`, `attach_place_in_editor` 구현.
  - 네이버 Local Search API 0건 시 정규화 + region_hint 1회 재시도 후 실패 처리.
- 실패 전파 정책 변경:
  - `naver-poster/src/cli/post_to_naver.ts`에서 장소첨부 실패 시 즉시 오류로 중단.
  - `src/services/blog_workflow.py`에서 네이버 업로드 실패를 상위 워크플로우 실패로 전파.
- 검증:
  - `npm run build` 성공.
  - `npm test -- --runInBand parser.test.ts` 성공.
  - `./venv/bin/python3 -m py_compile src/services/blog_workflow.py` 성공.
- 텔레그램 업로드 무응답 이슈 대응(15:00대):
  - 증상: 워크플로우가 `네이버 업로드` 단계에서 멈추고, 사용자에게 최종 실패 메시지가 가지 않음.
  - 원인: `src/services/blog_workflow.py`의 `naver-poster`/`--autoLogin` subprocess가 타임아웃 없이 `communicate()` 대기하여 hang.
  - 조치:
    - `NAVER_UPLOAD_TIMEOUT_SECONDS`(기본 420s), `NAVER_AUTOLOGIN_TIMEOUT_SECONDS`(기본 120s) 도입.
    - timeout 시 subprocess kill + stderr에 TIMEOUT 마커 남기고 실패/재시도로 전파.
    - 워크플로우 실패 메시지를 사용자 친화적으로 축약해 전달.
    - `src/telegram/service_layer.py` 실패 응답을 `safe_reply_text_async`로 전송하고 Markdown 실패 시 plain text 폴백 추가.
  - 배포: systemd 서비스(`naverpost-bot`) 메인 PID를 kill하여 자동 재기동, 새 코드 반영 완료(PID 교체 확인).
- 스크립트 구조/경로 영향 점검 보강(2026-02-16 20:xx):
  - `etc_scripts/*.py` 운영 엔트리포인트에 `Path(__file__).resolve()` 기반 프로젝트 루트 고정 + `os.chdir(project_root)` 표준화 적용.
  - `docs/scripts.md`를 분류/이동 목록, crontab 전후, 하위 스크립트 경로 영향, 검증 로그 요약 포함 형태로 확장.
  - 검증 중 발견된 런타임 결함 보수:
    - `requirements.txt`에 `psutil==5.9.8` 추가.
    - `src/utils/image_processor.py`에 `StabilizedImageProcessor` 호환 래퍼 추가.
    - `etc_scripts/monitor_bot_health.py` 폴백 DNS 체크 함수 보강.
    - `etc_scripts/test_stabilization_system.py`의 `--quick` 모드 실사용, logger 호환, 네이버맵 클라이언트 초기화/메서드 호출 호환 보정.
  - 확인: `./venv/bin/python3 etc_scripts/test_stabilization_system.py --quick` PASS, `fix_dns_issues --diagnose-only` PASS, `monitor_bot_health --one-shot`는 봇 미실행 상태로 exit 1(의도된 헬스체크 경고).
- naver-poster 420s 타임아웃 재발 방지 보수:
  - `naver-poster/src/cli/post_to_naver.ts`에 단계 타임아웃(`NAVER_STEP_TIMEOUT_SECONDS`, 기본 30s), 무응답 워치독(`NAVER_SILENCE_WATCHDOG_SECONDS`, 기본 60s), 강화된 timeout 디버그 수집(`logs/naver_timeout_debug/{ts}`: screenshot/html/frame_html/active_element/current_stage) 추가.
  - `naver-poster/src/utils/logger.ts`에 activity hook 추가하여 로그 침묵 기반 watchdog 구현.
  - `naver-poster/src/naver/editor.ts`에서 이미지 1장 업로드 timeout을 기본 20s(`NAVER_IMAGE_UPLOAD_TIMEOUT_MS`)로 제한, 임시저장 후 성공 신호 대기 timeout 20s(`NAVER_TEMP_SAVE_SIGNAL_TIMEOUT_MS`) 도입.
  - `naver-poster/src/naver/session.ts`에 브라우저/로그인/글쓰기 진입 timing 로그 추가.
  - `src/services/blog_workflow.py`에 `NAVER_CLIENT_HANG` 분류 추가, `[TIMEOUT] subprocess exceeded ...`/`stage_timeout`/`silence_watchdog` 감지 시 재시도 중단(fail-fast)하도록 보강.
- 네이버 로그인/세션 만료 구조 개선:
  - `naver-poster/src/naver/session.ts`에 사전 세션 점검 `preflightSessionForUpload`, 만료 복구 `recoverExpiredSession`, 상태 저장 `persistSessionState` 추가.
  - `[session] cookies_loaded/login_detected/auto_login_triggered` 로그를 추가해 세션 판단 근거를 남기도록 보강.
  - storage state + webStorage(local/sessionStorage) 스냅샷 저장/복원 경로(`NAVER_STORAGE_STATE_PATH` 기반) 도입.
  - 네이버 메인 URL만으로 로그인 성공 처리하던 로직을 제거해 오탐 가능성 축소.
  - `post_to_naver.ts`에서 업로드 전 사전 로그인 검증을 강제하고, 업로드 중 로그인 redirect 감지 시 자동 복구 1회 후 동일 단계 재시도하도록 연결.
